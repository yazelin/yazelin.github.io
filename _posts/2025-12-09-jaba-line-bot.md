---
layout: post
title: Jaba LINE Bot - è®“é»žé¤å°è©±é€²å…¥ LINE
tags: [å°ˆæ¡ˆ, Python, Flask, LINE Bot, API, Claude Code, SDD]
---

[Jaba LINE Bot](https://github.com/yazelin/jaba-line-bot) æ˜¯å‘·çˆ¸ AI åˆé¤è¨‚ä¾¿ç•¶ç³»çµ±çš„ LINE ä»‹é¢ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ç›´æŽ¥åœ¨ LINE ä¸­èˆ‡ AI å°è©±é»žé¤ã€‚

é€™å€‹å°ˆæ¡ˆæ˜¯ [jaba æ ¸å¿ƒç³»çµ±]({{ site.baseurl }}/jaba/) çš„å»¶ä¼¸ï¼Œé€éŽ LINE Messaging API å°‡é»žé¤åŠŸèƒ½å¸¶å…¥æœ€å¸¸ç”¨çš„é€šè¨Šè»Ÿé«”ä¸­ã€‚

---

## ç‚ºä»€éº¼åšé€™å€‹ï¼Ÿ

jaba ç³»çµ±æœ¬èº«æ˜¯ä¸€å€‹ç¶²é æ‡‰ç”¨ï¼Œä½†æ¯æ¬¡é»žé¤éƒ½è¦æ‰“é–‹ç€è¦½å™¨ç•¥é¡¯éº»ç…©ã€‚æ—¢ç„¶å¤§å®¶æ¯å¤©éƒ½åœ¨ç”¨ LINEï¼Œä½•ä¸è®“é»žé¤å°è©±ç›´æŽ¥åœ¨ LINE ä¸­é€²è¡Œï¼Ÿ

**ä½¿ç”¨æƒ…å¢ƒ**ï¼š
- å€‹äººèŠå¤©ï¼šè¨­å®šå€‹äººåå¥½ï¼ˆã€Œå«æˆ‘å°æ˜Žã€ã€Œæˆ‘ä¸åƒè¾£ã€ï¼‰
- ç¾¤çµ„èŠå¤©ï¼šèªªã€Œé–‹å–®ã€é–‹å§‹ç¾¤çµ„é»žé¤ï¼Œæˆå“¡ç›´æŽ¥å–Šé¤é»žåç¨±

---

## ç³»çµ±æž¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTPS      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LINE ä½¿ç”¨è€…    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  LINE Platform  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚   Render        â”‚
â”‚  (æ‰‹æ©Ÿ/é›»è…¦)     â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   (webhook)     â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  (jaba-line-bot)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                              â”‚
                                                                              â”‚ HTTPS
                                                                              â”‚ (API Key)
                                                                              â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚   jaba ç³»çµ±      â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   nginx         â”‚
                                   â”‚  (AI é»žé¤æ ¸å¿ƒ)   â”‚               â”‚  (API Gateway)  â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒå…ƒä»¶

| å…ƒä»¶ | èªªæ˜Ž | éƒ¨ç½²ä½ç½® |
|------|------|----------|
| **LINE Bot** | æŽ¥æ”¶/å›žè¦† LINE è¨Šæ¯ | Render (é›²ç«¯) |
| **jaba ç³»çµ±** | AI é»žé¤æ ¸å¿ƒé‚è¼¯ | æœ¬åœ°ä¼ºæœå™¨ |
| **nginx** | API Gatewayã€æµé‡åˆ†æµ | æœ¬åœ°ä¼ºæœå™¨ |

---

## åŠŸèƒ½ç‰¹è‰²

- **1å°1 èŠå¤©**ï¼šè¨­å®šå€‹äººåå¥½ï¼ˆåç¨±ã€é£²é£Ÿé™åˆ¶ï¼‰ï¼Œåœ¨ç¾¤çµ„é»žé¤æ™‚è‡ªå‹•å¥—ç”¨
- **ç¾¤çµ„é»žé¤ Session**ï¼šç¾¤çµ„å°ˆå±¬é»žé¤æµç¨‹ï¼Œè¨‚å–®ç¨ç«‹ç®¡ç†
- **ç™½åå–®æ©Ÿåˆ¶**ï¼šåƒ…å•Ÿç”¨çš„ä½¿ç”¨è€…/ç¾¤çµ„å¯ä½¿ç”¨
- **è‡ªå‹•æ¸…ç†**ï¼šBot è¢«è¸¢å‡ºç¾¤çµ„æˆ–ä½¿ç”¨è€…å°éŽ–æ™‚ï¼Œè‡ªå‹•æ¸…é™¤ç›¸é—œè³‡æ–™

---

## ç¾¤çµ„é»žé¤æµç¨‹

é€™æ˜¯æœ€ä¸»è¦çš„åŠŸèƒ½ï¼Œè®“ç¾¤çµ„æˆå“¡å¯ä»¥å¿«é€Ÿå®Œæˆåœ˜é«”è¨‚é¤ï¼š

```
1. èªªã€Œé–‹å–®ã€â†’ é–‹å§‹ç¾¤çµ„é»žé¤ï¼Œé¡¯ç¤ºä»Šæ—¥èœå–®
2. æˆå“¡ç›´æŽ¥èªªé¤é»žï¼ˆå¦‚ã€Œé›žè…¿ä¾¿ç•¶ã€ã€Œçå¥¶ å¾®å¾® Lã€ï¼‰
3. æ”¯æ´è·Ÿå–®ï¼šã€Œ+1ã€ã€Œæˆ‘ä¹Ÿè¦ã€
4. èªªã€Œèœå–®ã€â†’ æŸ¥çœ‹ä»Šæ—¥èœå–®
5. èªªã€Œç›®å‰è¨‚å–®ã€â†’ æŸ¥çœ‹é»žé¤ç‹€æ³
6. èªªã€Œæ”¶å–®ã€æˆ–ã€Œçµå–®ã€â†’ çµæŸé»žé¤ï¼Œé¡¯ç¤ºè¨‚å–®æ‘˜è¦
```

### ç¾¤çµ„æŒ‡ä»¤

| æŒ‡ä»¤ | èªªæ˜Ž |
|------|------|
| `é–‹å–®` | é–‹å§‹ç¾¤çµ„é»žé¤ï¼Œè‡ªå‹•é¡¯ç¤ºä»Šæ—¥èœå–® |
| `æ”¶å–®` / `çµå–®` | çµæŸé»žé¤ï¼Œé¡¯ç¤ºè¨‚å–®æ‘˜è¦ |
| `èœå–®` | æŸ¥çœ‹ä»Šæ—¥å¯é»žçš„èœå–® |
| `ç›®å‰è¨‚å–®` | æŸ¥çœ‹ç›®å‰é»žé¤ç‹€æ³ |
| `+1` / `æˆ‘ä¹Ÿè¦` | è·Ÿå–®ï¼ˆé»žå’Œä¸Šä¸€å€‹äººç›¸åŒçš„é¤é»žï¼‰ |
| `@jaba å‘·çˆ¸` | é¡¯ç¤ºç‹€æ…‹å’Œå¯ç”¨æŒ‡ä»¤èªªæ˜Ž |

### é£²æ–™ç¸®å¯«

æ”¯æ´å¸¸è¦‹çš„é£²æ–™é»žæ³•ç¸®å¯«ï¼š

| ç¸®å¯« | æ„æ€ |
|------|------|
| `å¾®å¾®` | å¾®ç³–å¾®å†° |
| `å°‘å°‘` | å°‘ç³–å°‘å†° |
| `åŠåŠ` | åŠç³–åŠå†° |
| `å…¨å…¨` | å…¨ç³–å…¨å†° |

ä¾‹å¦‚ï¼šã€Œçå¥¶ å¾®å¾® Lã€= çç å¥¶èŒ¶ å¾®ç³–å¾®å†° å¤§æ¯

### è§¸ç™¼æ–¹å¼

| æƒ…å¢ƒ | è§¸ç™¼æ–¹å¼ |
|------|----------|
| 1å°1 èŠå¤© | åå¥½è¨­å®šç›¸é—œè¨Šæ¯ï¼ˆé»žé¤è«‹é€éŽç¾¤çµ„ï¼‰ |
| ç¾¤çµ„ï¼ˆæœªé»žé¤ï¼‰ | `é–‹å–®`ã€`èœå–®`ã€`@jaba å‘·çˆ¸`ã€å•Ÿç”¨å¯†ç¢¼ |
| ç¾¤çµ„ï¼ˆé»žé¤ä¸­ï¼‰ | æ‰€æœ‰è¨Šæ¯éƒ½æœƒè™•ç†ï¼ˆAI éŽæ¿¾éžè¨‚é¤è¨Šæ¯ï¼‰ |

---

### ç™½åå–® + å¯†ç¢¼å•Ÿç”¨

ç‚ºäº†æŽ§åˆ¶ä½¿ç”¨æ¬Šé™ï¼ŒæŽ¡ç”¨å¯†ç¢¼å•Ÿç”¨æ©Ÿåˆ¶ï¼š

1. ç®¡ç†å“¡è¨­å®šå•Ÿç”¨å¯†ç¢¼ï¼ˆç’°å¢ƒè®Šæ•¸ `REGISTER_SECRET`ï¼‰
2. ä½¿ç”¨è€…åœ¨ LINE ä¸­è¼¸å…¥å¯†ç¢¼
3. ç³»çµ±è‡ªå‹•å°‡ä½¿ç”¨è€…/ç¾¤çµ„åŠ å…¥ç™½åå–®
4. ä¹‹å¾Œå³å¯æ­£å¸¸ä½¿ç”¨é»žé¤åŠŸèƒ½

**è‡ªå‹•ç§»é™¤æ©Ÿåˆ¶**ï¼š
- Bot è¢«è¸¢å‡ºç¾¤çµ„ â†’ è‡ªå‹•ç§»é™¤è©²ç¾¤çµ„ç™½åå–®
- ä½¿ç”¨è€…å°éŽ– Bot â†’ è‡ªå‹•ç§»é™¤è©²ä½¿ç”¨è€…ç™½åå–®

```
ä½¿ç”¨è€…ï¼šï¼ˆè¼¸å…¥å¯†ç¢¼ï¼‰
Botï¼šðŸŽ‰ å•Ÿç”¨æˆåŠŸï¼ç¾åœ¨ä½ å¯ä»¥ä½¿ç”¨é»žé¤åŠŸèƒ½äº†ã€‚
```

---

## æŠ€è¡“æ£§

| æŠ€è¡“ | ç”¨é€” |
|------|------|
| **Flask** | Web æ¡†æž¶ï¼Œè™•ç† Webhook |
| **line-bot-sdk v3** | LINE Messaging API SDK |
| **Render** | é›²ç«¯éƒ¨ç½²å¹³å°ï¼ˆå…è²» HTTPSï¼‰ |
| **requests** | HTTP å®¢æˆ¶ç«¯ï¼Œå‘¼å« jaba API |

---

## é–‹ç™¼é‡é»ž

### 1. Webhook é©—è­‰

LINE Platform æœƒåœ¨æ¯å€‹è«‹æ±‚åŠ ä¸Š `X-Line-Signature`ï¼Œéœ€é©—è­‰ä»¥é˜²å½é€ ï¼š

```python
@app.route("/callback", methods=["POST"])
def callback():
    signature = request.headers.get("X-Line-Signature", "")
    body = request.get_data(as_text=True)

    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        abort(400)

    return "OK"
```

### 2. ç¾¤çµ„ Session æ©Ÿåˆ¶

ç¾¤çµ„ä½¿ç”¨ Session æ©Ÿåˆ¶æŽ§åˆ¶å›žæ‡‰ï¼š

```python
def should_respond(event, user_text):
    # 1å°1 èŠå¤©ï¼šæ°¸é å›žæ‡‰
    if event.source.type == "user":
        return True, user_text

    # ç¾¤çµ„ï¼šä½¿ç”¨ Session æ©Ÿåˆ¶
    group_id = event.source.group_id
    text_stripped = user_text.strip()

    # æª¢æŸ¥ç¾¤çµ„æ˜¯å¦åœ¨é»žé¤ä¸­
    is_ordering = check_group_session(group_id)

    if is_ordering:
        # é»žé¤ä¸­ï¼šæ‰€æœ‰è¨Šæ¯éƒ½è½‰ç™¼çµ¦ jabaï¼ˆAI æœƒéŽæ¿¾éžè¨‚é¤è¨Šæ¯ï¼‰
        return True, user_text
    else:
        # éžé»žé¤ä¸­ï¼šåªå›žæ‡‰ç‰¹å®šæŒ‡ä»¤
        if text_stripped in ["é–‹å–®", "èœå–®"]:
            return True, user_text
        # é‚„æœƒæª¢æŸ¥ï¼šå•Ÿç”¨å¯†ç¢¼ã€@å‘·çˆ¸/@jaba ç­‰ï¼ˆç°¡åŒ–çœç•¥ï¼‰
        return False, user_text
```

é€™æ¨£çš„å¥½è™•ï¼š
- é»žé¤ä¸­ä¸ç”¨æ¯å‰‡è¨Šæ¯éƒ½åŠ é—œéµå­—
- AI æœƒè‡ªå‹•éŽæ¿¾é–’èŠï¼Œåªå›žæ‡‰è¨‚é¤ç›¸é—œè¨Šæ¯
- éžé»žé¤æ™‚ä¸æœƒè¢«ç„¡é—œè¨Šæ¯æ‰“æ“¾

### 3. API Key ä¿è­·

å¤–éƒ¨è«‹æ±‚ jaba API éœ€æ”œå¸¶ API Keyï¼Œnginx è² è²¬é©—è­‰ï¼š

```python
def get_jaba_headers():
    headers = {"Content-Type": "application/json"}
    if jaba_api_key:
        headers["X-API-Key"] = jaba_api_key
    return headers
```

---

## ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸ | å¿…è¦ | èªªæ˜Ž |
|------|------|------|
| `LINE_CHANNEL_SECRET` | âœ… | LINE Channel Secret |
| `LINE_CHANNEL_ACCESS_TOKEN` | âœ… | LINE Channel Access Token |
| `JABA_API_URL` | âŒ | jaba API ç¶²å€ï¼ˆæœªè¨­å®šå‰‡ç‚º Echo æ¨¡å¼ï¼‰ |
| `JABA_API_KEY` | âŒ | API é©—è­‰é‡‘é‘° |
| `REGISTER_SECRET` | âŒ | å•Ÿç”¨å¯†ç¢¼ |

---

## éƒ¨ç½²åˆ° Render

å°ˆæ¡ˆåŒ…å« `render.yaml`ï¼Œå¯ä¸€éµéƒ¨ç½²ï¼š

1. Fork å°ˆæ¡ˆåˆ°è‡ªå·±çš„ GitHub
2. åœ¨ Render å»ºç«‹æ–° Web Serviceï¼Œé€£çµ GitHub repo
3. è¨­å®šç’°å¢ƒè®Šæ•¸
4. éƒ¨ç½²å®Œæˆå¾Œå–å¾— URLï¼ˆå¦‚ `https://jaba-line-bot.onrender.com`ï¼‰
5. åˆ° LINE Developers Console è¨­å®š Webhook URL

---

## å°ˆæ¡ˆçµæ§‹

```
jaba-line-bot/
â”œâ”€â”€ app.py                      # ä¸»ç¨‹å¼
â”œâ”€â”€ requirements.txt            # Python ä¾è³´
â”œâ”€â”€ render.yaml                 # Render éƒ¨ç½²è¨­å®š
â”œâ”€â”€ .env.example                # ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ nginx-config-for-server.conf # nginx è¨­å®šåƒè€ƒ
â”œâ”€â”€ docs/                       # è©³ç´°æ–‡ä»¶
â”‚   â”œâ”€â”€ architecture.md         # ç³»çµ±æž¶æ§‹
â”‚   â”œâ”€â”€ line-setup.md           # LINE è¨­å®š
â”‚   â”œâ”€â”€ deployment.md           # éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ jaba-integration.md     # jaba æ•´åˆ
â”‚   â””â”€â”€ configuration.md        # ç’°å¢ƒè®Šæ•¸
â””â”€â”€ openspec/                   # OpenSpec è¦æ ¼æ–‡ä»¶
    â”œâ”€â”€ specs/                  # åŠŸèƒ½è¦æ ¼
    â””â”€â”€ changes/                # è®Šæ›´æ­·å²
```

---

## å­¸åˆ°çš„äº‹

### LINE Bot SDK v3 çš„è®ŠåŒ–

v3 ç‰ˆæœ¬æ”¹ç”¨ `linebot.v3` æ¨¡çµ„ï¼Œèˆ‡èˆŠç‰ˆå·®ç•°ä¸å°ï¼š

```python
# v3 å¯«æ³•
from linebot.v3 import WebhookHandler
from linebot.v3.messaging import Configuration, ApiClient, MessagingApi

# éœ€è¦ç”¨ Context Manager
with ApiClient(configuration) as api_client:
    messaging_api = MessagingApi(api_client)
    messaging_api.reply_message(...)
```

### ç¾¤çµ„ä¸­å–å¾—ä½¿ç”¨è€…åç¨±

1å°1 èŠå¤©ç”¨ `get_profile(user_id)` å°±å¥½ï¼Œä½†ç¾¤çµ„ä¸­è¦ç”¨ `get_group_member_profile(group_id, user_id)`ï¼š

```python
if event.source.type == "group":
    profile = messaging_api.get_group_member_profile(
        event.source.group_id, user_id
    )
else:
    profile = messaging_api.get_profile(user_id)
```

### Render å…è²»æ–¹æ¡ˆçš„é™åˆ¶

- é–’ç½® 15 åˆ†é˜å¾Œæœƒä¼‘çœ 
- å–šé†’éœ€è¦ 30-60 ç§’
- ç¬¬ä¸€æ¬¡è¨Šæ¯å¯èƒ½æœƒå›  timeout å¤±æ•—ï¼Œä½¿ç”¨è€…éœ€å†ç™¼ä¸€æ¬¡

---

## ç›¸é—œé€£çµ

- [jaba-line-bot GitHub](https://github.com/yazelin/jaba-line-bot)
- [jaba æ ¸å¿ƒç³»çµ±]({{ site.baseurl }}/jaba/)
- [LINE Bot é–‹ç™¼æ•™å­¸]({{ site.baseurl }}/line-bot-guide/)
- [Render éƒ¨ç½²æ•™å­¸]({{ site.baseurl }}/render-deploy-guide/)
- [LINE Messaging API æ–‡ä»¶](https://developers.line.biz/en/docs/messaging-api/)
- [Render å®˜æ–¹æ–‡ä»¶](https://render.com/docs)
