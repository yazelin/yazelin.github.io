---
layout: post
title: Fish Fry Counter é­šè‹—è¨ˆæ•¸ç³»çµ±
categories: [Projects]
tags: [å°ˆæ¡ˆ, Python, FastAPI, OpenCV, YOLO, AI, Claude Code, SDD]
---

> **ğŸ“– å‰ç½®çŸ¥è­˜**
> - [uv å…¥é–€ï¼šæ¥µé€Ÿ Python å¥—ä»¶ç®¡ç†]({% post_url 2025-12-13-uv-basics %})
> - [Git å…¥é–€ï¼šç‰ˆæœ¬æ§åˆ¶åŸºç¤æŒ‡ä»¤]({% post_url 2025-12-13-git-basics %})

[Fish Fry Counter](https://github.com/yazelin/fish-cv) æ˜¯ä¸€å€‹ä½¿ç”¨é›»è…¦è¦–è¦ºæŠ€è¡“è‡ªå‹•è¨ˆç®—åœ–ç‰‡ä¸­é­šè‹—æ•¸é‡çš„å€‹äººç·´ç¿’å°ˆæ¡ˆã€‚

![é­šè‹—ç¯„ä¾‹](https://github.com/yazelin/yazelin.github.io/releases/download/blog-images/images-fish-cv-fish1.jpg)

---

### åŠŸèƒ½ç‰¹è‰²

- **é›™é‡åµæ¸¬æ–¹æ³•**ï¼š
  - **å‚³çµ± CV**ï¼šé–¾å€¼åˆ†å‰² + è¼ªå»“æª¢æ¸¬ + åˆ†æ°´å¶ºç®—æ³•
  - **YOLO æ·±åº¦å­¸ç¿’**ï¼šYOLOv8 ç‰©ä»¶åµæ¸¬æ¨¡å‹
- è‡ªå‹•åµæ¸¬å®¹å™¨å€åŸŸ (ROI)
- åˆ†æ°´å¶ºç®—æ³•åˆ†é›¢é‡ç–Šé­šè‹—
- Web ä»‹é¢ä¸Šå‚³åœ–ç‰‡ä¸¦é¡¯ç¤ºçµæœ
- RESTful API æ”¯æ´ç¨‹å¼åŒ–å‘¼å«
- æ”¯æ´ JPEGã€PNG åœ–ç‰‡æ ¼å¼

---

### æŠ€è¡“æ£§

| æŠ€è¡“ | ç”¨é€” |
|------|------|
| Python 3.10+ | ç¨‹å¼èªè¨€ |
| FastAPI | Web æ¡†æ¶ |
| OpenCV | å½±åƒè™•ç† |
| Ultralytics YOLOv8 | æ·±åº¦å­¸ç¿’åµæ¸¬ |
| uv | å¥—ä»¶ç®¡ç† |

---

### åµæ¸¬æµç¨‹

**å‚³çµ± CV æ–¹æ³•**ï¼š
1. åœ–ç‰‡è½‰ç°éš
2. é«˜æ–¯æ¨¡ç³Šé™å™ª
3. è‡ªé©æ‡‰é–¾å€¼åˆ†å‰²
4. å½¢æ…‹å­¸æ“ä½œï¼ˆé–‹é–‰é‹ç®—ï¼‰
5. åˆ†æ°´å¶ºç®—æ³•åˆ†é›¢é‡ç–Šç‰©é«”
6. è¼ªå»“æª¢æ¸¬èˆ‡éæ¿¾
7. æ¨™è¨˜ä¸¦è¨ˆæ•¸

**YOLO æ–¹æ³•**ï¼š
1. è¼‰å…¥ YOLOv8 æ¨¡å‹
2. åŸ·è¡Œç‰©ä»¶åµæ¸¬æ¨è«–
3. ä¾ä¿¡å¿ƒåº¦èˆ‡ IOU é–¾å€¼éæ¿¾
4. æ¨™è¨˜ä¸¦è¨ˆæ•¸

---

### API ç«¯é»

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `/` | GET | é¦–é  - åœ–ç‰‡ä¸Šå‚³ä»‹é¢ |
| `/api/methods` | GET | å–å¾—å¯ç”¨åµæ¸¬æ–¹æ³•åˆ—è¡¨ |
| `/api/count` | POST | ä¸Šå‚³åœ–ç‰‡ä¸¦è¨ˆç®—é­šè‹—æ•¸é‡ |
| `/api/result/{id}` | GET | å–å¾—æ¨™è¨˜éçš„çµæœåœ–ç‰‡ |
| `/docs` | GET | Swagger API æ–‡ä»¶ |

**API å›æ‡‰ç¯„ä¾‹**ï¼š
```json
{
  "count": 42,
  "annotated_image_url": "/api/result/uuid-here",
  "method": "cv"
}
```

---

### å°ˆæ¡ˆçµæ§‹

```
fish-cv/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                  # FastAPI æ‡‰ç”¨ç¨‹å¼é€²å…¥é»
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â””â”€â”€ counting.py          # è¨ˆæ•¸ API è·¯ç”±
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ fish_detector.py     # å‚³çµ± CV åµæ¸¬å™¨
â”‚   â”‚   â”œâ”€â”€ yolo_detector.py     # YOLO åµæ¸¬å™¨
â”‚   â”‚   â””â”€â”€ detector_factory.py  # åµæ¸¬å™¨å·¥å» 
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â””â”€â”€ index.html           # é¦–é æ¨¡æ¿
â”‚   â””â”€â”€ static/
â”‚       â””â”€â”€ style.css            # æ¨£å¼è¡¨
â”œâ”€â”€ models/                       # YOLO æ¨¡å‹æª”æ¡ˆ
â”œâ”€â”€ tests/                        # æ¸¬è©¦ç¨‹å¼
â””â”€â”€ pyproject.toml                # å°ˆæ¡ˆè¨­å®š
```

---

### åƒæ•¸èª¿æ•´

**å‚³çµ± CV åµæ¸¬å™¨åƒæ•¸**ï¼š
```python
detector = FishDetector(
    min_area=100,           # æœ€å°è¼ªå»“é¢ç©
    max_area=8000,          # æœ€å¤§è¼ªå»“é¢ç©
    min_aspect_ratio=1.5,   # æœ€å°é•·å¯¬æ¯”
    max_aspect_ratio=8.0,   # æœ€å¤§é•·å¯¬æ¯”
    blur_kernel=5,          # é«˜æ–¯æ¨¡ç³Šæ ¸å¤§å°
    block_size=21,          # è‡ªé©æ‡‰é–¾å€¼å€å¡Šå¤§å°
    use_watershed=True,     # å•Ÿç”¨åˆ†æ°´å¶ºç®—æ³•
)
```

**YOLO åµæ¸¬å™¨åƒæ•¸**ï¼š
```python
detector = YoloDetector(
    confidence=0.2,         # ä¿¡å¿ƒåº¦é–¾å€¼
    iou_threshold=0.3,      # NMS IOU é–¾å€¼
    device="auto",          # é‹ç®—è£ç½®
)
```

---

### å¿«é€Ÿé–‹å§‹

```bash
# å®‰è£ç›¸ä¾å¥—ä»¶
uv sync

# å•Ÿå‹•ä¼ºæœå™¨
uv run uvicorn app.main:app --reload

# é–‹å•Ÿç€è¦½å™¨
# http://localhost:8000
```

---

### GitHub

[https://github.com/yazelin/fish-cv](https://github.com/yazelin/fish-cv)
