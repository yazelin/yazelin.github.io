---
layout: post
title: "uv å…¥é–€ï¼šæ¥µé€Ÿ Python å¥—ä»¶ç®¡ç†"
subtitle: "å–ä»£ pipã€poetryã€pyenv çš„ç¾ä»£åŒ–å·¥å…·"
date: 2025-12-13
categories: [Python]
tags: [Python, uv, å¥—ä»¶ç®¡ç†, è™›æ“¬ç’°å¢ƒ]
---

> **ğŸ“š å»¶ä¼¸é–±è®€**
> - [Linux çµ‚ç«¯æ©Ÿå…¥é–€ï¼šé–‹ç™¼è€…å¿…å‚™æŒ‡ä»¤]({% post_url 2025-12-13-linux-basics %})
> - [Docker åŸºç¤æ¦‚å¿µèˆ‡å¸¸ç”¨æŒ‡ä»¤]({% post_url 2025-12-13-docker-basics %})
> - [SDD è¦æ ¼é©…å‹•é–‹ç™¼å…¥é–€ï¼šç’°å¢ƒå®‰è£ç¯‡]({% post_url 2025-12-07-sdd-setup-guide %})

---

## é€™ç¯‡æ–‡ç« è¦è§£æ±ºä»€éº¼å•é¡Œï¼Ÿ

**æ–°äºº**ï¼šã€Œæˆ‘è¦è£ Python å¥—ä»¶ï¼Œpipã€poetryã€pipenvã€conda åˆ°åº•ç”¨å“ªå€‹ï¼Ÿã€

**è³‡æ·±å·¥ç¨‹å¸«**ï¼šã€Œç¾åœ¨æœ‰å€‹æ–°å·¥å…·å« uvï¼Œä¸€å€‹å°±èƒ½å–ä»£å®ƒå€‘å…¨éƒ¨ã€‚ã€

**æ–°äºº**ï¼šã€Œåˆä¸€å€‹æ–°å·¥å…·ï¼Ÿå­¸ä¸å®Œäº†...ã€

**è³‡æ·±å·¥ç¨‹å¸«**ï¼šã€Œé€™å€‹çœŸçš„å€¼å¾—å­¸ï¼Œå®‰è£å¥—ä»¶å¿« 10-100 å€ï¼Œè€Œä¸”æŒ‡ä»¤å¾ˆç°¡å–®ã€‚ã€

**æ–°äºº**ï¼šã€ŒçœŸçš„æœ‰é‚£éº¼å¿«ï¼Ÿã€

**è³‡æ·±å·¥ç¨‹å¸«**ï¼šã€Œç”¨ Rust å¯«çš„ï¼Œæˆ‘å€‘å°ˆæ¡ˆå¾ poetry æ›éä¾†å¾Œï¼ŒCI æ™‚é–“å°‘äº†ä¸€åŠã€‚ã€

é€™ç¯‡æ–‡ç« æœƒè®“ä½ å­¸æœƒï¼š
- uv è§£æ±ºä»€éº¼å•é¡Œ
- å®‰è£èˆ‡åŸºæœ¬è¨­å®š
- å°ˆæ¡ˆç®¡ç†ï¼ˆinitã€addã€syncï¼‰
- åŸ·è¡Œç¨‹å¼ï¼ˆrunï¼‰
- Python ç‰ˆæœ¬ç®¡ç†

---

## æŠ€è¡“æ¦‚å¿µ

### uv æ˜¯ä»€éº¼ï¼Ÿ

[uv](https://docs.astral.sh/uv/) æ˜¯ Astral å…¬å¸ç”¨ Rust é–‹ç™¼çš„ Python å¥—ä»¶èˆ‡å°ˆæ¡ˆç®¡ç†å·¥å…·ï¼Œå¯ä»¥å–ä»£ï¼š

| å‚³çµ±å·¥å…· | åŠŸèƒ½ | uv å°æ‡‰æŒ‡ä»¤ |
|----------|------|-------------|
| pip | å®‰è£å¥—ä»¶ | `uv add` / `uv pip install` |
| pip-tools | é–å®šä¾è³´ | `uv lock` |
| poetry | å°ˆæ¡ˆç®¡ç† | `uv init` / `uv add` |
| pyenv | Python ç‰ˆæœ¬ç®¡ç† | `uv python install` |
| virtualenv | è™›æ“¬ç’°å¢ƒ | `uv venv` |
| pipx | å…¨åŸŸå·¥å…· | `uv tool install` |

### ç‚ºä»€éº¼é¸ uvï¼Ÿ

| æ¯”è¼ƒé …ç›® | pip | poetry | uv |
|----------|-----|--------|-----|
| å®‰è£é€Ÿåº¦ | æ…¢ | ä¸­ç­‰ | **æ¥µå¿«ï¼ˆ10-100xï¼‰** |
| ä¾è³´è§£æ | åŸºæœ¬ | å®Œæ•´ | **å®Œæ•´** |
| Lock æª” | ç„¡ | æœ‰ | **æœ‰** |
| è™›æ“¬ç’°å¢ƒ | éœ€å¦è£ | å…§å»º | **å…§å»º** |
| Python ç‰ˆæœ¬ç®¡ç† | ç„¡ | ç„¡ | **å…§å»º** |
| å­¸ç¿’æ›²ç·š | ä½ | ä¸­ | **ä½** |

### é€Ÿåº¦æ¯”è¼ƒ

```
å®‰è£ Django + ç›¸ä¾å¥—ä»¶ï¼š

pip:     23.4 ç§’
poetry:  12.1 ç§’
uv:       0.8 ç§’  â† å¿« 29 å€
```

é€™å€‹é€Ÿåº¦å·®ç•°åœ¨ CI/CD ç’°å¢ƒä¸­ç‰¹åˆ¥æ˜é¡¯ï¼Œå¯ä»¥å¤§å¹…ç¸®çŸ­å»ºç½®æ™‚é–“ã€‚

---

## å®‰è£ uv

### Linux / macOS / WSL

```bash
# å®˜æ–¹å®‰è£è…³æœ¬
curl -LsSf https://astral.sh/uv/install.sh | sh

# é‡æ–°è¼‰å…¥ shell è¨­å®š
source ~/.bashrc   # æˆ– source ~/.zshrc

# é©—è­‰å®‰è£
uv --version    # uv 0.8.4
```

### å…¶ä»–å®‰è£æ–¹å¼

```bash
# Homebrew (macOS)
brew install uv

# pipxï¼ˆå¦‚æœå·²æœ‰ Python ç’°å¢ƒï¼‰
pipx install uv

# pipï¼ˆä¸å»ºè­°ï¼Œå¯èƒ½æœ‰æ¬Šé™å•é¡Œï¼‰
pip install uv
```

### è‡ªå‹•è£œå…¨ï¼ˆé¸ç”¨ï¼‰

```bash
# Bash
echo 'eval "$(uv generate-shell-completion bash)"' >> ~/.bashrc

# Zsh
echo 'eval "$(uv generate-shell-completion zsh)"' >> ~/.zshrc

# Fish
uv generate-shell-completion fish > ~/.config/fish/completions/uv.fish
```

---

## è·Ÿè‘—åšï¼šå°ˆæ¡ˆç®¡ç†

### 1. åˆå§‹åŒ–å°ˆæ¡ˆ

```bash
# å»ºç«‹æ–°å°ˆæ¡ˆç›®éŒ„
mkdir my-project && cd my-project

# åˆå§‹åŒ– uv å°ˆæ¡ˆ
uv init
```

åŸ·è¡Œå¾Œæœƒç”¢ç”Ÿï¼š

```
my-project/
â”œâ”€â”€ .python-version    # Python ç‰ˆæœ¬
â”œâ”€â”€ pyproject.toml     # å°ˆæ¡ˆè¨­å®š
â”œâ”€â”€ README.md          # èªªæ˜æ–‡ä»¶
â””â”€â”€ hello.py           # ç¯„ä¾‹ç¨‹å¼
```

### 2. æ–°å¢å¥—ä»¶

```bash
# æ–°å¢å¥—ä»¶
uv add fastapi

# æ–°å¢å¤šå€‹å¥—ä»¶
uv add fastapi uvicorn sqlalchemy

# æ–°å¢é–‹ç™¼ç”¨å¥—ä»¶ï¼ˆä¸æœƒæ‰“åŒ…åˆ°æ­£å¼ç’°å¢ƒï¼‰
uv add --dev pytest ruff

# æŒ‡å®šç‰ˆæœ¬
uv add "requests>=2.28,<3.0"
```

åŸ·è¡Œå¾Œï¼š
- `pyproject.toml` æœƒæ›´æ–° dependencies
- `uv.lock` æœƒé–å®šæ‰€æœ‰ç›¸ä¾å¥—ä»¶çš„ç‰ˆæœ¬
- `.venv/` è™›æ“¬ç’°å¢ƒæœƒè‡ªå‹•å»ºç«‹ä¸¦å®‰è£å¥—ä»¶

### 3. ç§»é™¤å¥—ä»¶

```bash
uv remove requests
```

### 4. åŒæ­¥ä¾è³´

ç•¶ä½  clone ä¸€å€‹å°ˆæ¡ˆï¼Œæˆ– `uv.lock` æœ‰æ›´æ–°æ™‚ï¼š

```bash
# æ ¹æ“š uv.lock å®‰è£æ‰€æœ‰å¥—ä»¶
uv sync

# åŒ…å«é–‹ç™¼å¥—ä»¶
uv sync --dev
```

### 5. æ›´æ–°å¥—ä»¶

```bash
# æ›´æ–°æ‰€æœ‰å¥—ä»¶
uv lock --upgrade

# æ›´æ–°ç‰¹å®šå¥—ä»¶
uv lock --upgrade-package requests
```

---

## è·Ÿè‘—åšï¼šåŸ·è¡Œç¨‹å¼

### uv run åŸºæœ¬ç”¨æ³•

`uv run` æœƒè‡ªå‹•åœ¨è™›æ“¬ç’°å¢ƒä¸­åŸ·è¡ŒæŒ‡ä»¤ï¼Œä¸éœ€è¦æ‰‹å‹• activateï¼š

```bash
# åŸ·è¡Œ Python æª”æ¡ˆ
uv run python main.py

# åŸ·è¡Œæ¨¡çµ„
uv run python -m pytest

# åŸ·è¡Œå¥—ä»¶æä¾›çš„æŒ‡ä»¤
uv run uvicorn main:app --reload

# åŸ·è¡Œæ¸¬è©¦
uv run pytest tests/ -v

# åŸ·è¡Œ linter
uv run ruff check .
```

### å°æ¯”å‚³çµ±æ–¹å¼

```bash
# å‚³çµ±æ–¹å¼ï¼ˆéœ€è¦æ‰‹å‹•ç®¡ç†è™›æ“¬ç’°å¢ƒï¼‰
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python main.py
deactivate

# uv æ–¹å¼ï¼ˆä¸€è¡Œæå®šï¼‰
uv run python main.py
```

### å¸¸è¦‹é–‹ç™¼æŒ‡ä»¤

```bash
# å•Ÿå‹• FastAPI é–‹ç™¼ä¼ºæœå™¨
uv run uvicorn main:app --reload --port 8000

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
uv run alembic upgrade head

# åŸ·è¡Œæ¸¬è©¦ä¸¦é¡¯ç¤ºè¦†è“‹ç‡
uv run pytest --cov=app tests/

# æ ¼å¼åŒ–ç¨‹å¼ç¢¼
uv run ruff format .

# æª¢æŸ¥ç¨‹å¼ç¢¼é¢¨æ ¼
uv run ruff check .
```

---

## è·Ÿè‘—åšï¼šPython ç‰ˆæœ¬ç®¡ç†

uv å…§å»º Python ç‰ˆæœ¬ç®¡ç†ï¼Œä¸éœ€è¦å¦å¤–å®‰è£ pyenvã€‚

### å®‰è£ Python

```bash
# å®‰è£æœ€æ–°ç©©å®šç‰ˆ
uv python install

# å®‰è£æŒ‡å®šç‰ˆæœ¬
uv python install 3.12

# å®‰è£å¤šå€‹ç‰ˆæœ¬
uv python install 3.11 3.12
```

### æŸ¥çœ‹å·²å®‰è£ç‰ˆæœ¬

```bash
uv python list
```

è¼¸å‡ºç¯„ä¾‹ï¼š
```
cpython-3.12.3-linux-x86_64-gnu    /home/ct/.local/share/uv/python/cpython-3.12.3
cpython-3.11.9-linux-x86_64-gnu    /home/ct/.local/share/uv/python/cpython-3.11.9
```

### å›ºå®šå°ˆæ¡ˆ Python ç‰ˆæœ¬

```bash
# è¨­å®šå°ˆæ¡ˆä½¿ç”¨ Python 3.12
uv python pin 3.12
```

é€™æœƒå»ºç«‹æˆ–æ›´æ–° `.python-version` æª”æ¡ˆï¼Œåœ˜éšŠæˆå“¡éƒ½æœƒä½¿ç”¨ç›¸åŒç‰ˆæœ¬ã€‚

### ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬åŸ·è¡Œ

```bash
# ç”¨ Python 3.11 åŸ·è¡Œ
uv run --python 3.11 python main.py
```

---

## pyproject.toml è¨­å®š

uv ä½¿ç”¨æ¨™æº–çš„ `pyproject.toml` æ ¼å¼ï¼š

```toml
[project]
name = "my-project"
version = "0.1.0"
description = "æˆ‘çš„å°ˆæ¡ˆ"
readme = "README.md"
requires-python = ">=3.11"
dependencies = [
    "fastapi>=0.109.0",
    "uvicorn>=0.27.0",
    "sqlalchemy>=2.0.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.0.0",
    "ruff>=0.2.0",
]

[tool.uv]
dev-dependencies = [
    "pytest>=8.0.0",
    "ruff>=0.2.0",
]
```

### å¸¸ç”¨è¨­å®š

| æ¬„ä½ | èªªæ˜ |
|------|------|
| `requires-python` | Python ç‰ˆæœ¬éœ€æ±‚ |
| `dependencies` | æ­£å¼ç’°å¢ƒä¾è³´ |
| `[project.optional-dependencies]` | é¸ç”¨ä¾è³´ç¾¤çµ„ |
| `[tool.uv]` | uv å°ˆå±¬è¨­å®š |

---

## é€²éšåŠŸèƒ½

### 1. å¾ requirements.txt é·ç§»

```bash
# åŒ¯å…¥ç¾æœ‰çš„ requirements.txt
uv add -r requirements.txt

# åŒ¯å…¥é–‹ç™¼ä¾è³´
uv add --dev -r requirements-dev.txt
```

### 2. åŒ¯å‡º requirements.txt

å¦‚æœéœ€è¦ç›¸å®¹èˆŠç³»çµ±ï¼š

```bash
# åŒ¯å‡ºæ‰€æœ‰ä¾è³´
uv pip compile pyproject.toml -o requirements.txt

# åŒ¯å‡ºå«é–‹ç™¼ä¾è³´
uv pip compile pyproject.toml --extra dev -o requirements-dev.txt
```

### 3. å…¨åŸŸå·¥å…·å®‰è£

```bash
# å®‰è£å…¨åŸŸå·¥å…·ï¼ˆé¡ä¼¼ pipxï¼‰
uv tool install ruff
uv tool install black

# åˆ—å‡ºå·²å®‰è£çš„å·¥å…·
uv tool list

# åŸ·è¡Œå…¨åŸŸå·¥å…·
uvx ruff check .
```

### 4. å¿«å–ç®¡ç†

```bash
# æŸ¥çœ‹å¿«å–ä½ç½®
uv cache dir

# æ¸…é™¤å¿«å–
uv cache clean
```

---

## å¸¸ç”¨æŒ‡ä»¤é€ŸæŸ¥

### å°ˆæ¡ˆç®¡ç†

| æŒ‡ä»¤ | èªªæ˜ |
|------|------|
| `uv init` | åˆå§‹åŒ–æ–°å°ˆæ¡ˆ |
| `uv add <å¥—ä»¶>` | æ–°å¢å¥—ä»¶ |
| `uv add --dev <å¥—ä»¶>` | æ–°å¢é–‹ç™¼å¥—ä»¶ |
| `uv remove <å¥—ä»¶>` | ç§»é™¤å¥—ä»¶ |
| `uv sync` | åŒæ­¥ä¾è³´ |
| `uv lock` | æ›´æ–° lock æª” |
| `uv lock --upgrade` | æ›´æ–°æ‰€æœ‰å¥—ä»¶ |

### åŸ·è¡Œç¨‹å¼

| æŒ‡ä»¤ | èªªæ˜ |
|------|------|
| `uv run python <æª”æ¡ˆ>` | åŸ·è¡Œ Python æª”æ¡ˆ |
| `uv run <æŒ‡ä»¤>` | åœ¨è™›æ“¬ç’°å¢ƒä¸­åŸ·è¡ŒæŒ‡ä»¤ |
| `uv run --python 3.11 <æŒ‡ä»¤>` | æŒ‡å®š Python ç‰ˆæœ¬åŸ·è¡Œ |

### Python ç‰ˆæœ¬

| æŒ‡ä»¤ | èªªæ˜ |
|------|------|
| `uv python install` | å®‰è£ Python |
| `uv python install 3.12` | å®‰è£æŒ‡å®šç‰ˆæœ¬ |
| `uv python list` | åˆ—å‡ºå·²å®‰è£ç‰ˆæœ¬ |
| `uv python pin 3.12` | å›ºå®šå°ˆæ¡ˆç‰ˆæœ¬ |

### å…¶ä»–

| æŒ‡ä»¤ | èªªæ˜ |
|------|------|
| `uv --version` | æŸ¥çœ‹ç‰ˆæœ¬ |
| `uv self update` | æ›´æ–° uv |
| `uv cache clean` | æ¸…é™¤å¿«å– |

---

## å¸¸è¦‹å•é¡Œ

### 1. æ‰¾ä¸åˆ° Python

```bash
# è§£æ³•ï¼šç”¨ uv å®‰è£ Python
uv python install 3.12
```

### 2. è™›æ“¬ç’°å¢ƒåœ¨å“ªè£¡ï¼Ÿ

uv é è¨­å»ºç«‹åœ¨å°ˆæ¡ˆç›®éŒ„çš„ `.venv/`ï¼š

```bash
ls -la .venv/
```

### 3. å¦‚ä½•æ‰‹å‹•å•Ÿç”¨è™›æ“¬ç’°å¢ƒï¼Ÿ

é€šå¸¸ä¸éœ€è¦ï¼Œ`uv run` æœƒè‡ªå‹•è™•ç†ã€‚ä½†å¦‚æœéœ€è¦ï¼š

```bash
source .venv/bin/activate
```

### 4. èˆ‡ IDE æ•´åˆ

å¤§å¤šæ•¸ IDEï¼ˆVS Codeã€PyCharmï¼‰æœƒè‡ªå‹•åµæ¸¬ `.venv/`ï¼Œå¦‚æœæ²’æœ‰ï¼š

- **VS Code**ï¼š`Ctrl+Shift+P` â†’ "Python: Select Interpreter" â†’ é¸æ“‡ `.venv/bin/python`
- **PyCharm**ï¼šSettings â†’ Project â†’ Python Interpreter â†’ é¸æ“‡ `.venv/bin/python`

### 5. CI/CD ä½¿ç”¨

```yaml
# GitHub Actions ç¯„ä¾‹
- name: Install uv
  uses: astral-sh/setup-uv@v4

- name: Install dependencies
  run: uv sync

- name: Run tests
  run: uv run pytest
```

---

## å°çµ

| æ¦‚å¿µ | é‡é» |
|------|------|
| uv ç”¨é€” | å–ä»£ pipã€poetryã€pyenv çš„ä¸€ç«™å¼å·¥å…· |
| å®‰è£ | `curl -LsSf https://astral.sh/uv/install.sh \| sh` |
| å°ˆæ¡ˆç®¡ç† | `uv init`ã€`uv add`ã€`uv sync` |
| åŸ·è¡Œç¨‹å¼ | `uv run` è‡ªå‹•è™•ç†è™›æ“¬ç’°å¢ƒ |
| Python ç‰ˆæœ¬ | `uv python install/list/pin` |
| å„ªå‹¢ | å¿« 10-100 å€ã€æŒ‡ä»¤ç°¡å–®ã€åŠŸèƒ½å®Œæ•´ |

ç¾åœ¨ä½ å¯ä»¥ç”¨ uv ä¾†ç®¡ç† Python å°ˆæ¡ˆäº†ï¼

---

## åƒè€ƒè³‡æº

- [uv å®˜æ–¹æ–‡ä»¶](https://docs.astral.sh/uv/)
- [uv GitHub](https://github.com/astral-sh/uv)
- [pyproject.toml è¦ç¯„](https://packaging.python.org/en/latest/specifications/pyproject-toml/)
